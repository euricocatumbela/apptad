import{r as t,h as a,H as s}from"./p-8fb49ffc.js";import{Logger as e,Hub as i}from"@aws-amplify/core";import{A as n}from"./p-417bb5ea.js";import{appendToCognitoUserAgent as r,Auth as o}from"@aws-amplify/auth";import"./p-915bcfdd.js";import{T as h,U as c,A as l,R as u,N as m,c as p}from"./p-2915ed18.js";import{d as f,o as d}from"./p-b7cf913b.js";import{c as g}from"./p-a5a9b451.js";const y=new e("Authenticator"),w=class{constructor(a){t(this,a),this.initialAuthState=n.SignIn,this.handleAuthStateChange=()=>{},this.authState=n.Loading,this.toastMessage="",this.handleExternalAuthEvent=({payload:t})=>{switch(t.event){case"cognitoHostedUI":case"signIn":g(t.data,f);break;case"cognitoHostedUI_failure":case"parsingUrl_failure":case"signOut":case"customGreetingSignOut":return f(this.initialAuthState)}},this.handleToastEvent=({payload:t})=>{switch(t.event){case h:t.message&&(this.toastMessage=t.message)}}}async componentWillLoad(){d((t,a)=>{this.onAuthStateChange(t,a),this.toastMessage=""}),i.listen(c,this.handleToastEvent),i.listen(l,this.handleExternalAuthEvent),r("amplify-authenticator");const t=localStorage.getItem(u);localStorage.removeItem(u),"true"!==t&&await this.checkUser()}async checkUser(){if(!o||"function"!=typeof o.currentAuthenticatedUser)throw new Error(m);return o.currentAuthenticatedUser().then(t=>{f(n.SignedIn,t)}).catch(async()=>{let t=null;try{t=localStorage.getItem(p)}catch(a){y.debug("Failed to get the auth state from local storage",a)}try{t===n.SignedIn&&await o.signOut(),f(this.initialAuthState)}catch(a){y.debug("Failed to sign out",a)}})}async onAuthStateChange(t,a){if(void 0===t)return y.error("nextAuthState cannot be undefined");y.info("Inside onAuthStateChange Method current authState:",this.authState),this.authState=t===n.SignedOut?this.initialAuthState:t,this.authData=a,this.authData&&y.log("Auth Data was set:",this.authData),this.authState===t&&(this.handleAuthStateChange(this.authState,this.authData),y.info("authState has been updated to "+this.authState))}renderAuthComponent(t){switch(t){case n.SignIn:return a("slot",{name:"sign-in"},a("amplify-sign-in",{federated:this.federated,usernameAlias:this.usernameAlias}));case n.ConfirmSignIn:return a("slot",{name:"confirm-sign-in"},a("amplify-confirm-sign-in",{user:this.authData}));case n.SignUp:return a("slot",{name:"sign-up"},a("amplify-sign-up",{usernameAlias:this.usernameAlias}));case n.ConfirmSignUp:return a("slot",{name:"confirm-sign-up"},a("amplify-confirm-sign-up",{user:this.authData,usernameAlias:this.usernameAlias}));case n.ForgotPassword:return a("slot",{name:"forgot-password"},a("amplify-forgot-password",{usernameAlias:this.usernameAlias}));case n.ResetPassword:return a("slot",{name:"require-new-password"},a("amplify-require-new-password",{user:this.authData}));case n.VerifyContact:return a("slot",{name:"verify-contact"},a("amplify-verify-contact",{user:this.authData}));case n.TOTPSetup:return a("slot",{name:"totp-setup"},a("amplify-totp-setup",{user:this.authData}));case n.Loading:return a("slot",{name:"loading"},a("div",null,"Loading..."));case n.SignedIn:return[a("slot",{name:"greetings"}),a("slot",null)];default:throw new Error("Unhandled auth state: "+t)}}componentWillUnload(){return i.remove(l,this.handleExternalAuthEvent),i.remove(c,this.handleToastEvent),d}render(){return a(s,null,this.toastMessage?a("amplify-toast",{message:this.toastMessage,handleClose:()=>{this.toastMessage=""},"data-test":"authenticator-error"}):null,this.authState===n.SignedIn?this.renderAuthComponent(this.authState):a("div",{class:"auth-container"},this.renderAuthComponent(this.authState)))}};w.style=":host{--background-color:var(--amplify-background-color);--width:28.75rem;--min-width:20rem;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;--box-shadow:1px 1px 4px 0 rgba(0, 0, 0, 0.15);--border-radius:6px;--padding:35px 40px;--margin-bottom:20px;--container-height:100vh;--container-display:flex;--container-justify:center;--container-align:center}.auth-container{display:var(--container-display);-ms-flex-pack:var(--container-justify);justify-content:var(--container-justify);-ms-flex-align:var(--container-align);align-items:var(--container-align);min-height:var(--container-height)}";export{w as amplify_authenticator}